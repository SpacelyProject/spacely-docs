# Peary Device Files

The "Peary Device Files" are a collection of C++ files that tell Peary how to communicate with your chip. 

*In the original Caribou system,* test engineers needed to create a new set of Peary Device Files for every new chip they wanted to test. These files would reside in the folder **peary/devices/\<DeviceName\>**, where **\<DeviceName\>** is the name of the chip. 

*However, in Spacely-Caribou systems,* we use one common set of Device Files for all chips, with only one small part (the memory map) which needs to be customized. Custom code that is specific to one ASIC [should, as always, be written in Python](</special-topics/philosophy/Appropriate Use of Abstraction.md>). The common Device Files for Spacely-Caribou are found in the folder **peary/devices/SpacelyCaribouBasic**. They are [included automatically when you download the latest version of Peary.](<https://gitlab.cern.ch/adquinn/peary/-/tree/aq_dev/devices/SpacelyCaribouBasic?ref_type=heads>)


The following sections describe the specific files you will find in the SpacelyCaribouBasic folder.

## SpacelyCaribouBasicDevice.cpp and .hpp

These files contain the definitions for basic functions that are used to interact with the CaR board, like **car_i2c_read()** and **car_i2c_write()**.

The constructor function in SpacelyCaribouBasicDevice.cpp (lines 11 to 74) also sets up the various functions (```_dispatcher.add()```) and CaR board resources (```_periphery.add()```) that can be controlled through Peary, for example PWR_OUT and BIAS lines. 

In general, you should **NOT** need to modify these files during normal use of Spacely-Caribou. 


## SpacelyCaribouBasicDefaults.hpp

This file contains the memory map (```#define FPGA_REGS```), which is the only part of the Device Files which needs to be modified for a specific chip. The memory map is a table which tells Peary the physical addresses of named registers in your firmware.

You should **NOT** try to write this memory map by hand, which is error-prone. Instead use Spacely's **gen_mem_map()** util, as described in [Creating a Memory Map](</spacely-caribou/test-firmware-design/Creating a Memory Map.md>).


## Si5345 Files

You may also see header files which start with "Si5345". These files are generated by ClockBuilderPro and used for configuring the Si5345 clock generator chip on the CaR board. This is an advanced task not covered here.

If you are not using the Si5345, you may ignore these files.

